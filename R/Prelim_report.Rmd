---
title: "Preliminary report for WP3: tail-dependent spatial synchrony among birds"
author: "Shyamolina"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::html_document2:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    code_folding: hide
---

```{r include = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      include = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      cache = FALSE)
```

```{r echo = FALSE}
#rm(list = ls())
library(here)
#library(ggpmisc)
library(tidyverse)
library(gridExtra)
library(ggpubr)
source(here("R", "mtime.R"))
```

# Intro

```{r insert-pdf-conceptual-fig, fig.cap="Conceptual figure (will update later)", out.height = "460px", out.width='800px'}
knitr::include_graphics(here("Results/conceptual_fig/routes_on_map_selectedsites_conceptual.pdf"),rel_path = F)
```

# Results

## r=0-250km

```{r insert-pdf-synabund-r0-250km, fig.cap="Spatial synchrony among metapopulation abundance (1997-2019; r=0-250 Km) (A) for species those are synchronously rare, (B) for species those are synchronously abundant. Numeric codes in gray color are unique code for each species (see given csv file for details).", out.height = "460px", out.width='800px'}
knitr::include_graphics(here("Results/visualize_spat_syn_for_abund_0_250km_inkscape.pdf"),rel_path = F)
```

```{r summarize-plot-res-for-r0-250km, echo=F}
source(here("R","summarize_res.R"))
```

### Testing body-traits for both red and blue group of birds

```{r test_hypo, echo=F}
# We will test some hypotheses related to trait-difference 
# among two groups showing LT and UT spatial synchrony
source(here("R/test_hypo.R")) 
```

<!--
```{r insert-pdf-phylo-r0-250km, fig.cap="Spatial synchrony and phylogeny for bird species (within 0-250 km).", out.height = "460px", out.width='800px'}
# source(here("R/test_tree.R")) this code generated the below pdf
knitr::include_graphics(here("Results/species_phylogeny_0_250km.pdf"),rel_path = F)
```
-->

```{r plot_opt_bio, echo=F}

# source(here("R/get_bio_opt_for_species.R"))
# see CHELSA description file to understand variables
df_opt<-read.csv(here("RESULTS/df_abund_climate_spatsyn_0_250km_with_optimal_biovar.csv"))

g1<-ggplot(df_opt, aes(x=fLU_ab, y=bio1, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio1")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")

g12<-ggplot(df_opt, aes(x=fLU_ab, y=bio12, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio12")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")

g9<-ggplot(df_opt, aes(x=fLU_ab, y=bio9, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio9")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")
g10<-ggplot(df_opt, aes(x=fLU_ab, y=bio10, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio10")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")

g17<-ggplot(df_opt, aes(x=fLU_ab, y=bio17, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio17")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")
g18<-ggplot(df_opt, aes(x=fLU_ab, y=bio18, col=tail, shape=tail)) + 
  geom_point(alpha=0.5)+geom_smooth(se=F,method="lm")+
  labs(title="",x="spat syn (abund)",y="bio18")+
  theme_bw()+theme(legend.position = "none", legend.box = "horizontal")

grid.arrange(g1,g12,g9,g10,g17,g18, nrow=3)
# see, first, third row
```

**bio1=** mean annual air temperature (degree C), mean annual daily mean air temperatures averaged over 1 year.

**bio12=** annual precipitation amount (Kg m$^{-2}$ per year), Accumulated precipitation amount over 1 year.

**bio9=** mean daily mean air temperatures of the driest quarter (degree C), The driest quarter of the year is determined (to the nearest month).

**bio10=** mean daily mean air temperatures of the warmest quarter (degree C), The warmest quarter of the year is determined (to the nearest month).

**bio17=** mean monthly precipitation amount of the driest quarter (Kg m$^{-2}$ per month), The driest quarter of the year is determined (to the nearest month).

**bio18=** mean monthly precipitation amount of the warmest quarter (Kg m$^{-2}$ per month), The warmest quarter of the year is determined (to the nearest month).

```{r spat-syn-vs-distance-plot, fig.cap="Spatial synchrony vs. distance category plot.", out.height = "460px", out.width='800px'}
knitr::include_graphics(here("Results/spat_syn_vs_distance_plot.pdf"),rel_path = F)
```

<!--
## r=250-500km

```{r insert-pdf-synabund-r250-500km, fig.cap="Spatial synchrony among metapopulation abundance (1997-2019; r=250-500 Km) (A) for species those are synchronously rare, (B) for species those are synchronously abundant. Numeric codes in gray color are unique code for each species (see given csv file for details).", out.height = "460px", out.width='800px'}
knitr::include_graphics(here("Results/visualize_spat_syn_for_abund_250_500km_inkscape.pdf"),rel_path = F)
```

```{r summarize-plot-res-for-r250-500km, echo=F}
summarize_res(chosen_rad = c(250,500)) # for visually testing Q2
```
-->
**But** to me the species appeared differently in two groups: some species were synchronously rare across metapopulation sites, and some were synchronously common. I think the first group of species were limited by some climatic stressors whereas the second group got the benefit. So, why not consider the dataset separately for each group?


**So**, from the above groupwise plots, I can see that rainfall and maxT were important for rare group - and maxT only was important for common group (considering each variable separately - don't know how it would be in a multiple variable model). I can see opposite pattern between two groups, though, for all climate variable.

```{r method-fig, echo=F, results="hide"}
source(here("R/method_fig.R"))
```


